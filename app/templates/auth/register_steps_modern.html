{% extends "base_modern.html" %}

{% block title %}Join Pantamak - Step {{ step }} of 5{% endblock %}

{% block meta_description %}Create your Pantamak account and join Cameroon's premier local marketplace. Connect with shops, discover products, and build your business.{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-green-50 via-white to-yellow-50 py-12 px-4 sm:px-6 lg:px-8">
    <!-- Background Decoration -->
    <div class="absolute inset-0 overflow-hidden pointer-events-none">
        <div class="absolute -top-40 -right-40 w-80 h-80 bg-gradient-to-br from-green-200 to-yellow-200 rounded-full opacity-20 animate-pulse-soft"></div>
        <div class="absolute -bottom-40 -left-40 w-80 h-80 bg-gradient-to-tr from-yellow-200 to-green-200 rounded-full opacity-20 animate-pulse-soft" style="animation-delay: 1s;"></div>
    </div>

    <div class="relative max-w-md mx-auto">
        <!-- Header Card -->
        <div class="text-center mb-8 animate-fade-in">
            <div class="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-r from-green-600 to-yellow-500 rounded-full shadow-lg mb-6 animate-bounce-gentle">
                <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Pantamak" class="w-12 h-12 rounded-lg">
            </div>
            <h1 class="text-3xl font-bold gradient-text mb-2">Join Pantamak</h1>
            <p class="text-gray-600 mb-4">Step {{ step }} of 5 - 
                {% if step == 1 %}Create Your Account
                {% elif step == 2 %}Personal Information  
                {% elif step == 3 %}Location & Preferences
                {% elif step == 4 %}Business Information
                {% elif step == 5 %}Final Preferences
                {% endif %}
            </p>
            
            <!-- Progress Bar -->
            <div class="w-full bg-gray-200 rounded-full h-3 mb-6 overflow-hidden">
                <div class="bg-gradient-to-r from-green-600 to-yellow-500 h-3 rounded-full transition-all duration-700 ease-out shadow-sm"
                     style="width: {{ (step / 5) * 100 }}%"></div>
            </div>
            
            <!-- Step Indicators -->
            <div class="flex justify-center space-x-2 mb-8">
                {% for i in range(1, 6) %}
                    <div class="flex flex-col items-center">
                        <div class="w-8 h-8 rounded-full flex items-center justify-center text-xs font-semibold transition-all duration-300
                                    {% if i <= step %}bg-gradient-to-r from-green-600 to-yellow-500 text-white shadow-md
                                    {% else %}bg-gray-200 text-gray-500{% endif %}">
                            {% if i < step %}
                                <i class="fas fa-check"></i>
                            {% else %}
                                {{ i }}
                            {% endif %}
                        </div>
                        <div class="text-xs text-gray-500 mt-1 hidden sm:block">
                            {% if i == 1 %}Account
                            {% elif i == 2 %}Personal
                            {% elif i == 3 %}Location
                            {% elif i == 4 %}Business
                            {% elif i == 5 %}Finish
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>

        <!-- Registration Form Card -->
        <div class="bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden animate-slide-up">
            <!-- Card Header -->
            <div class="bg-gradient-to-r from-green-600 to-yellow-500 px-6 py-4">
                <div class="flex items-center justify-between text-white">
                    <div>
                        <h2 class="text-lg font-semibold">
                            {% if step == 1 %}üîê Secure Your Account
                            {% elif step == 2 %}üë§ Tell Us About Yourself
                            {% elif step == 3 %}üìç Where Are You Located?
                            {% elif step == 4 %}üè¢ About Your Business
                            {% elif step == 5 %}‚öôÔ∏è Final Touches
                            {% endif %}
                        </h2>
                        <p class="text-green-100 text-sm">
                            {% if step == 1 %}Choose your login credentials
                            {% elif step == 2 %}Help us personalize your experience
                            {% elif step == 3 %}Connect with local opportunities
                            {% elif step == 4 %}Set up your business profile
                            {% elif step == 5 %}Customize your preferences
                            {% endif %}
                        </p>
                    </div>
                    <div class="text-2xl opacity-80">
                        {% if step == 1 %}üõ°Ô∏è
                        {% elif step == 2 %}üôã‚Äç‚ôÇÔ∏è
                        {% elif step == 3 %}üåç
                        {% elif step == 4 %}üè™
                        {% elif step == 5 %}‚ú®
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Form Body -->
            <div class="p-6">
                <form method="POST" novalidate class="space-y-6" x-data="registrationForm()">
                    {{ form.hidden_tag() }}
                    
                    {% for field in form %}
                        {% if field.type != 'HiddenField' and field.type != 'SubmitField' and field.type != 'CSRFTokenField' %}
                            <div class="form-group" x-data="{ focused: false, hasValue: false }" 
                                 x-init="hasValue = $refs.input.value.length > 0">
                                
                                <!-- Floating Label Design -->
                                <div class="relative">
                                    {% if field.type == 'SelectField' %}
                                        {{ field(class="form-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200 bg-white text-gray-900 appearance-none",
                                               x-ref="input",
                                               "@focus"="focused = true",
                                               "@blur"="focused = false; hasValue = $event.target.value.length > 0",
                                               "@input"="hasValue = $event.target.value.length > 0",
                                               **({'class': 'border-red-300 ring-red-500'} if field.errors else {})) }}
                                        <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                            <i class="fas fa-chevron-down text-gray-400"></i>
                                        </div>
                                    {% elif field.type == 'TextAreaField' %}
                                        {{ field(class="form-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200 bg-white text-gray-900 resize-none",
                                               x-ref="input",
                                               "@focus"="focused = true",
                                               "@blur"="focused = false; hasValue = $event.target.value.length > 0",
                                               "@input"="hasValue = $event.target.value.length > 0",
                                               rows="4",
                                               **({'class': 'border-red-300 ring-red-500'} if field.errors else {})) }}
                                    {% else %}
                                        {{ field(class="form-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200 bg-white text-gray-900",
                                               x-ref="input",
                                               "@focus"="focused = true",
                                               "@blur"="focused = false; hasValue = $event.target.value.length > 0",
                                               "@input"="hasValue = $event.target.value.length > 0",
                                               **({'class': 'border-red-300 ring-red-500'} if field.errors else {})) }}
                                    {% endif %}
                                    
                                    <!-- Floating Label -->
                                    <label for="{{ field.id }}" 
                                           class="absolute left-4 transition-all duration-200 pointer-events-none"
                                           :class="focused || hasValue ? 'top-0 text-xs text-green-600 bg-white px-2 -translate-y-1/2' : 'top-1/2 text-gray-500 -translate-y-1/2'">
                                        {{ field.label.text }}
                                        {% if field.flags.required %}
                                            <span class="text-red-500">*</span>
                                        {% endif %}
                                    </label>
                                </div>
                                
                                <!-- Field Icon -->
                                {% if field.name == 'email' %}
                                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                        <i class="fas fa-envelope text-gray-400"></i>
                                    </div>
                                {% elif field.name in ['password', 'password2'] %}
                                    <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                                        <button type="button" @click="togglePassword()" class="text-gray-400 hover:text-gray-600">
                                            <i class="fas" :class="showPassword ? 'fa-eye-slash' : 'fa-eye'"></i>
                                        </button>
                                    </div>
                                {% elif field.name in ['first_name', 'last_name'] %}
                                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                        <i class="fas fa-user text-gray-400"></i>
                                    </div>
                                {% elif field.name == 'phone_number' %}
                                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                        <i class="fas fa-phone text-gray-400"></i>
                                    </div>
                                {% elif field.name in ['country', 'city'] %}
                                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                        <i class="fas fa-map-marker-alt text-gray-400"></i>
                                    </div>
                                {% endif %}
                                
                                <!-- Error Messages -->
                                {% if field.errors %}
                                    <div class="mt-2 flex items-center text-red-600 text-sm animate-fade-in">
                                        <i class="fas fa-exclamation-circle mr-1"></i>
                                        {% for error in field.errors %}
                                            <span>{{ error }}</span>{% if not loop.last %}, {% endif %}
                                        {% endfor %}
                                    </div>
                                {% endif %}
                                
                                <!-- Help Text -->
                                {% if field.description %}
                                    <p class="mt-2 text-sm text-gray-500 flex items-center">
                                        <i class="fas fa-info-circle mr-1"></i>
                                        {{ field.description }}
                                    </p>
                                {% endif %}
                            </div>
                        {% endif %}
                    {% endfor %}
                    
                    <!-- Action Buttons -->
                    <div class="flex flex-col sm:flex-row gap-4 pt-6">
                        {% if step > 1 %}
                            <a href="{{ url_for('auth.register', step=step-1) }}" 
                               class="flex-1 flex items-center justify-center px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-all duration-200 font-medium">
                                <i class="fas fa-arrow-left mr-2"></i>
                                Back
                            </a>
                        {% endif %}
                        
                        {{ form.submit(class="flex-1 bg-gradient-to-r from-green-600 to-yellow-500 text-white px-6 py-3 rounded-lg font-semibold hover:from-green-700 hover:to-yellow-600 transition-all duration-200 transform hover:scale-105 shadow-lg hover:shadow-xl flex items-center justify-center",
                                      "@click"="submitForm()",
                                      "x-bind:disabled"="loading") }}
                        
                        <template x-if="loading">
                            <div class="absolute inset-0 flex items-center justify-center">
                                <div class="loader"></div>
                            </div>
                        </template>
                    </div>
                </form>
                
                <!-- Additional Links -->
                {% if step == 1 %}
                    <div class="mt-8 pt-6 border-t border-gray-200">
                        <div class="text-center">
                            <p class="text-gray-600 mb-4">Already have an account?</p>
                            <a href="{{ url_for('auth.login') }}" 
                               class="inline-flex items-center px-6 py-2 border border-green-600 text-green-600 rounded-lg hover:bg-green-50 transition-all duration-200 font-medium">
                                <i class="fas fa-sign-in-alt mr-2"></i>
                                Sign In Instead
                            </a>
                        </div>
                        
                        <!-- Trust Indicators -->
                        <div class="mt-6 flex items-center justify-center space-x-6 text-sm text-gray-500">
                            <div class="flex items-center">
                                <i class="fas fa-shield-alt text-green-500 mr-1"></i>
                                Secure
                            </div>
                            <div class="flex items-center">
                                <i class="fas fa-clock text-green-500 mr-1"></i>
                                2 min setup
                            </div>
                            <div class="flex items-center">
                                <i class="fas fa-gift text-green-500 mr-1"></i>
                                Free forever
                            </div>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Help Card -->
        <div class="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4 animate-fade-in">
            <div class="flex items-start">
                <div class="flex-shrink-0">
                    <i class="fas fa-question-circle text-blue-500 mt-1"></i>
                </div>
                <div class="ml-3">
                    <h3 class="text-sm font-medium text-blue-800">Need Help?</h3>
                    <p class="text-sm text-blue-700 mt-1">
                        {% if step == 1 %}Choose a strong password with at least 8 characters.
                        {% elif step == 2 %}This information helps us personalize your Pantamak experience.
                        {% elif step == 3 %}We'll show you shops and opportunities in your area.
                        {% elif step == 4 %}Tell us about your business to attract more customers.
                        {% elif step == 5 %}These preferences can be changed later in your settings.
                        {% endif %}
                    </p>
                    <a href="{{ url_for('main.contact') }}" class="text-sm text-blue-600 hover:text-blue-800 font-medium">
                        Contact Support ‚Üí
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    function registrationForm() {
        return {
            loading: false,
            showPassword: false,
            
            togglePassword() {
                this.showPassword = !this.showPassword;
                const passwordInputs = document.querySelectorAll('input[type="password"], input[type="text"]');
                passwordInputs.forEach(input => {
                    if (input.name.includes('password')) {
                        input.type = this.showPassword ? 'text' : 'password';
                    }
                });
            },
            
            submitForm() {
                this.loading = true;
                // Form will submit normally, loading state will show
            }
        }
    }

    // Auto-focus first input
    document.addEventListener('DOMContentLoaded', function() {
        const firstInput = document.querySelector('input:not([type="hidden"]), select');
        if (firstInput) {
            firstInput.focus();
        }
    });

    // Real-time validation feedback
    document.querySelectorAll('input[type="email"]').forEach(input => {
        input.addEventListener('blur', function() {
            if (this.value && !validateEmail(this.value)) {
                this.classList.add('border-red-300');
                this.classList.remove('border-gray-300');
            } else {
                this.classList.remove('border-red-300');
                this.classList.add('border-gray-300');
            }
        });
    });

    document.querySelectorAll('input[type="tel"], input[name*="phone"]').forEach(input => {
        input.addEventListener('blur', function() {
            if (this.value && !validatePhone(this.value)) {
                this.classList.add('border-red-300');
                this.classList.remove('border-gray-300');
            } else {
                this.classList.remove('border-red-300');
                this.classList.add('border-gray-300');
            }
        });
    });
</script>
{% endblock %}
